# 专题模板系统文档

## 项目目录

* 开发目录：https://svn.yy.com/yy-music/web/beifen/concert/mobile/modpage
* 测试环境：https://svn.yy.com/yy-music/web-dragon/big-idol/cont/branches/commit/cont-web/src/main/webapp/static/modpage/mobile
* 线上环境：https://svn.yy.com/yy-music/web-dragon/big-idol/cont/trunk/cont-web/src/main/webapp/static/modpage/mobile

## 接口文档

[http://doc.ys.m.yy.com:8090/pages/viewpage.action?pageId=2392399](http://doc.ys.m.yy.com:8090/pages/viewpage.action?pageId=2392399)

## 开发流程：

开发目录运行`npm run dev`进行开发调试，运行`npm run build`进行打包。

代码中接口使用了相对路径，因此页面需要代理到www.yy.com的域名进行开发。

打包后比对到测试环境目录（一般直接复制过去），比对后运行 **web-static-package.bat** 进行批处理编译，代码会编译到同目录的 web-static 文件夹，然后提交代码进行潜龙发布。

线上环境同理比对后运行 **web-static-package.bat**。

潜龙上的业务名称为：活动发布平台(content)

潜龙上的项目名称为：活动web静态工程(cont_web_static)

## 统一后台管理系统

进入OA（[https://portal.hiido.com](https://portal.hiido.com)）-> 系统入口 -> 统一后台管理系统 -> 内容发布平台 -> 专题页发布模块

通过配置Host切换到测试环境

```
# 运营平台测试
101.226.20.188	admin.cont.yy.com	
101.226.20.188	res.cont.yy.com	
101.226.20.188	res1.cont.yy.com
101.226.20.188  www.yy.com
101.226.20.188	cont.yy.com
183.36.117.141 web.yy.com
183.36.117.141 web.yystatic.com
183.36.117.141 web1.yystatic.com
183.36.117.141 web2.yystatic.com
183.36.117.141 web3.yystatic.com
116.31.121.127 actgw.yy.com
```

可配置自己的页面进行测试，或使用已有的 [http://www.yy.com/c/testpage/index.htm](http://www.yy.com/c/testpage/index.htm)

后台管理系统具体配置请找负责的后端人员：巫倩育

## 模板模块

* 后台配置模块名：文件名 
* 头图模块：bannerSection
* 图片模块：picSection
* 视频播放模块：videoPlayer
* 视频展示模块：reviewSection
* 直播回放模块：liveSection
* 相关直播模块：liveRelatedSection
* 主播主题聚合页模块：anchorSetSection
* 主播订阅模块：countDownSection
* 节目订阅模块：pCountDownSection
* 直播预告模块：yugaoSection
* 新闻资讯模块：newsSection
* 投票模块：voteSection
* 排行榜模块：rankSection
* 多排行榜模块：rankSet/rankSetSection
* 评论模块：comment/commentSection
* 报名模块：signup/signupSection
* 底栏悬浮模块：footBannerSection
* 分享模块：mobileShareSection
* 自定义模块：无

## 统计代码

* src/js/hiido_v2.js：页面埋点
* src/lib/js/commons/webentvediodo.js：YY活动分端分渠道PCU在线时长数据上报需求（直播时添加上报）
* src/lib/js/commons/webpcucount.js：YY活动分端分渠道PCU在线时长数据上报需求（直播时添加上报）
* src/lib/js/commons/webyyhb.js：web端用户日活心跳协议（是否直播都会上报）
* src/lib/js/commons/webyylogin.js：web端用户载入视频播放页面协议（是否直播都会上报）

## 如何新建一个模块

### 模板结构

新建一个模块结构，并提供给后端用于拼接

```
<section class="${color}" data-modName="${modNewModule}" data-modId="${modId}"
	// 内容
</section>
```

* color：模板色系【后端填充】
* modNewModule：模块标识（根据这些标识异步加载模块js）【前端填充】
* modId：模块id【后端填充】

### 样式文件

把样式文件名称提供给后端，用于拼接样式文件的 combo url。

http://res.cont.yy.com/modpage/mobile/css/??rankSetSection.css,rankListSection.css

### 控制模块显示

在 *src/js/checkModules.js* 中增加模块标识。

```
var checkModules = {
    options: {
        bannerSection: false, //头图模块
		myNewSection: false // 新模块
    },
    check: function() {
        var modSection = document.getElementsByClassName("common-section");
        for (var i = 0; i < modSection.length; i++) {
            var name = modSection[i].getAttribute("data-modName");
            switch (name) {
                case 'modBanner':
                    this.options.bannerSection = true;
                    break;
				case '${modNewModule}': // 模块标识
					this.options.myNewSection = true;
                    break;
            }
        }
        return this.options;
    }
}
```

### 入口文件

在入口文件 *src/index.js* 中增加模块脚本引入，并执行。

```
if (options.myNewSection) {
	require.ensure('./js/myNewSection.js', function (require) {
		var myNewSection = require('./js/myNewSection.js');
		myNewSection.init();
	}, 'myNewSection');
}
```